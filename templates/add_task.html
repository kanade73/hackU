<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¿ã‚¹ã‚¯è¿½åŠ </title>
  <style>
    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼é–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .menu-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #2a7ae2;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
    .menu-btn {
      margin: 0 15px;
      text-decoration: none;
      color: #fff;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .menu-icon {
      font-size: 1.5em;
    }
    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼åˆ†ã®ä½™ç™½ã‚’ç¢ºä¿ */
    .content {
      padding-top: 60px;
    }
    
    /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
    body {
      font-family: Arial, sans-serif;
      padding: 2em;
    }
    label {
      display: block;
      margin-top: 1em;
    }
    input, select, button {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.2em;
      box-sizing: border-box;
    }
    button {
      margin-top: 1.5em;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤ºç”¨ãƒœã‚¿ãƒ³ */
    .inline-btn {
      width: auto;
      display: inline-block;
      margin-top: 0.2em;
      margin-left: 0.5em;
    }
    /* æˆ»ã‚‹ãƒªãƒ³ã‚¯ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .back-link {
      margin-top: 2em;
      display: block;
    }
    /* å‰å›ã®å…¥åŠ›ã‚’åæ˜ ã™ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .repeat-btn {
      margin-top: 1em;
      background-color: #008CBA;
    }
  </style>
</head>
<body>
  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
  <div class="menu-bar">
    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <a href="{{ url_for('index') }}" class="menu-btn" title="ãƒ¡ã‚¤ãƒ³ç”»é¢">
      <span class="menu-icon">ğŸ </span>
      <span class="menu-text">ãƒ¡ã‚¤ãƒ³</span>
    </a>
    <!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ç”»é¢ -->
    <a href="{{ url_for('add_task') }}" class="menu-btn" title="ã‚¿ã‚¹ã‚¯è¿½åŠ ">
      <span class="menu-icon">â•</span>
      <span class="menu-text">è¿½åŠ </span>
    </a>
    <!-- è¨­å®šç”»é¢ -->
    <a href="{{ url_for('setup') }}" class="menu-btn" title="è¨­å®š">
      <span class="menu-icon">âš™ï¸</span>
      <span class="menu-text">è¨­å®š</span>
    </a>
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† -->
  <div class="content">
    <h1>æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </h1>
    <!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="taskForm" action="{{ url_for('add_task') }}" method="POST">
      <label for="subject">ç§‘ç›®</label>
      <input type="text" name="subject" id="subject" required>

      <label for="timetable_select">ä»Šæ—¥ã®æ™‚é–“å‰²ã‹ã‚‰é¸æŠ</label>
      <select id="timetable_select" onchange="fillSubjectAndMaybeCategory()">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        {% for slot in timetable %}
          <option value="{{ slot.subject }}">{{ slot.period }}é™ï¼š{{ slot.subject }}</option>
        {% endfor %}
      </select>

      <label for="category">ã‚«ãƒ†ã‚´ãƒª</label>
      <input type="text" name="category" id="category" required placeholder="ä¾‹ï¼šæ•°å­¦, ç†ç§‘ãªã©" onblur="saveCategory()">

      <label for="difficulty">ã‚„ã‚ŠãŸããªã•ï¼ˆ1ã€œ5ï¼‰</label>
      <select name="difficulty" id="difficulty" required>
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="1">1ï¼ˆã‚„ã‚Šã‚„ã™ã„ï¼‰</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5ï¼ˆã‚„ã‚ŠãŸããªã„ï¼‰</option>
      </select>

      <label for="due_date">ç· åˆ‡æ—¥</label>
      <div style="display: flex; align-items: center;">
        <!-- æ—¥ä»˜å…¥åŠ›æ¬„ -->
        <input type="date" name="due_date" id="due_date" required onclick="openDatePicker(event)">
        <!-- ä¸€é€±é–“å¾Œãƒœã‚¿ãƒ³ -->
        <button type="button" class="inline-btn" onclick="setWeekLater()">ä¸€é€±é–“å¾Œ</button>
      </div>

      <!-- ã€Œå‰ã¨åŒã˜ã€ãƒœã‚¿ãƒ³ï¼šå‰å›ã®å…¥åŠ›ã‚’åæ˜ ã—ã€ç· åˆ‡æ—¥ã‚’ä¸€é€±é–“å¾Œã«è¨­å®š -->
      <button type="button" class="repeat-btn" onclick="fillPreviousTask()">å‰ã¨åŒã˜</button>

      <button type="submit">è¿½åŠ ã™ã‚‹</button>
    </form>

    <!-- ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <a href="{{ url_for('index') }}" class="back-link">â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>
  </div>

  <script>
    // ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¸ã‚“ã ç§‘ç›®ã‚’ç§‘ç›®æ¬„ã«åæ˜ ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚‚åæ˜ ã™ã‚‹
    function fillSubjectAndMaybeCategory() {
      const selectedSubject = document.getElementById("timetable_select").value;
      if (selectedSubject) {
        document.getElementById("subject").value = selectedSubject;
      }
      const savedCategory = localStorage.getItem("last_category");
      if (savedCategory) {
        document.getElementById("category").value = savedCategory;
      }
    }

    // ã‚«ãƒ†ã‚´ãƒªæ¬„ã®å†…å®¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹
    function saveCategory() {
      const category = document.getElementById("category").value;
      if (category) {
        localStorage.setItem("last_category", category);
      }
    }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ç§‘ç›®ã¨é›£æ˜“åº¦ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ï¼ˆä»»æ„ï¼‰
    document.getElementById("taskForm").addEventListener("submit", function() {
      const subject = document.getElementById("subject").value;
      const difficulty = document.getElementById("difficulty").value;
      localStorage.setItem("last_subject", subject);
      localStorage.setItem("last_difficulty", difficulty);
    });

    // ã€Œå‰ã¨åŒã˜ã€ãƒœã‚¿ãƒ³ï¼šå‰å›ã®å…¥åŠ›å€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ ã—ã€ç· åˆ‡æ—¥ã¯ä¸€é€±é–“å¾Œã«è¨­å®šã™ã‚‹
    function fillPreviousTask() {
      const subject = localStorage.getItem("last_subject") || "";
      const category = localStorage.getItem("last_category") || "";
      const difficulty = localStorage.getItem("last_difficulty") || "";
      document.getElementById("subject").value = subject;
      document.getElementById("category").value = category;
      document.getElementById("difficulty").value = difficulty;
      
      // ä¸€é€±é–“å¾Œã®æ—¥ä»˜ã‚’è¨ˆç®—ã—ã¦è¨­å®š
      const today = new Date();
      today.setDate(today.getDate() + 7);
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const formattedDate = `${yyyy}-${mm}-${dd}`;
      document.getElementById("due_date").value = formattedDate;
    }

    // æ—¥ä»˜å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã€å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹
    function openDatePicker(e) {
      const dateInput = e.target;
      if (dateInput.showPicker) {
        dateInput.showPicker();
      }
    }

    // ã€Œä¸€é€±é–“å¾Œã€ãƒœã‚¿ãƒ³ï¼šç· åˆ‡æ—¥ã‚’ä»Šæ—¥ã‹ã‚‰ä¸€é€±é–“å¾Œã«è¨­å®šã™ã‚‹
    function setWeekLater() {
      const today = new Date();
      today.setDate(today.getDate() + 7);
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const formattedDate = `${yyyy}-${mm}-${dd}`;
      document.getElementById("due_date").value = formattedDate;
    }
  </script>
</body>
</html>
